---
title: "Table1_Study_Population"
output: html_document
date: "2024-01-10"
---
# Yves Code Version

# Upload Data 
                          
```{r}
library(tidyr)
library(readxl)
library(dplyr)
library(openxlsx)
library(ggplot2)
library(stringr)
library(janitor)


# load data
file_path <- "/Users/miagrote/Library/Mobile Documents/com~apple~CloudDocs/Documents/2023/CPCOR/Metaanalyse/Datenextraktion - komplett.xlsx"

# Create a vector of sheet numbers
sheet_numbers <- c(3, 6, 9, 12, 15, 18, 21, 24, 27, 30)

# Initialize a list to store the cleaned data frames
data_sheets <- list()

# Loop through each sheet number
for (sheet_number in sheet_numbers) {
  # Read data from the sheet and clean column names
  df <- read_excel(file_path, sheet = sheet_number) %>% clean_names()

  # Replace "nicht zutreffend" with NA
  df[df == "nicht zutreffend"] <- NA

  # Add the cleaned data frame to the list
  data_sheets[[paste0("data_sheet", sheet_number)]] <- df
}

#from list to environment save as dataframes
list2env(data_sheets, envir = .GlobalEnv)


```


# Data Cleaning
## Add instrument_combination to each data frame

```{r}
#add in each sheet instrument_combination
data_sheet3 <- data_sheet3 %>% mutate(instrument_combination = "hads-promis")
data_sheet6 <- data_sheet6 %>% mutate(instrument_combination = "bdi-hads")
data_sheet9 <- data_sheet9 %>% mutate(instrument_combination = "hads-phq")
data_sheet12 <- data_sheet12 %>% mutate(instrument_combination = "phq-promis")
data_sheet15 <- data_sheet15 %>% mutate(instrument_combination = "bdi-promis")
data_sheet18 <- data_sheet18 %>% mutate(instrument_combination = "cesd-promis")
data_sheet21 <- data_sheet21 %>% mutate(instrument_combination = "cesd-phq")
data_sheet24 <- data_sheet24 %>% mutate(instrument_combination = "cesd-hads")
data_sheet27 <- data_sheet27 %>% mutate(instrument_combination = "bdi-phq")
data_sheet30 <- data_sheet30 %>% mutate(instrument_combination = "bdi-cesd")


```


## extract variables of interest
study -> "study" 

instrument -> "instrument" #noch dazufügen

instrument_combination -> "instrument_combination"

mean_original -> phq_cases_group_1_mean_sum_scores_number_1_timepoint #für alle Zeitpunkte und Gruppen im Mittel

mean_promis #noch dazufügen

time -> 

time_weeks

studytype (RTC oder nicht) -> "study_type_cross_sectional_observational_cohort_case_control_interventional_clinical_trial_randomized_trial_method_study"

n_gesamt

n_group -> "# of groups within study"

countries -> "Study country/-ies"

 
```{r}

```

```{r}
# Combine all data frames into a single data frame
combined_data <- do.call(bind_rows, data_sheets)

# Check the combined data frame
print("Combined Data:")
print(combined_data)
```



# Yves Code
```{r}
result_df_mean %>% 
  group_by(Study) %>% 
  slice(1)

result_df_age %>% 
  group_by(Study) %>% 
  slice(1) %>% 
  ungroup() %>% 
  summarize(mean_age = mean(Value, na.rm = T))


  table(result_df_mean$Groupinfo)
  
  result_list[[6]]
  
#install.packages("janitor")
library(janitor)
```
# Cleaning Yves Style

## Create Dataframe complete for all analysis (study, age, gender, country, study type, ...) 

variables of interest:
- y
-x
-study_type_cross_sectional_observational_cohort_case_control_interventional_clinical_trial_randomized_trial_method_study -> study_type, study_country_ies

"Study" -> study z.B. "Smith, 2020"
"Population description" -> population
"Condition studied", -> 



## Sheet 1-x

variables of interest:
- y
-x
-study_type_cross_sectional_observational_cohort_case_control_interventional_clinical_trial_randomized_trial_method_study -> study_type, study_country_ies

```{r}
read_excel(file_path, sheet = 6) %>% clean_names()

```

Structure

instrument_combination | instrument | t-score
bdi-hads                 hads         44
bdi-hads                 Bdi          46

## Combine datasets

bind_rows()

## Bring to https://docs.metapsy.org/data-preparation/format/ conventions


